version: '3'

services:
    db:
        # image: postgres:13
        image: postgis/postgis
        container_name: IsThereAGameDB
        environment:
            POSTGRES_USER: example
            POSTGRES_PASSWORD: example
            POSTGRES_DB: example_db
        ports:
            - "5432:5432"
        volumes:
            - postgres_data:/var/lib/postgresql/data

    app:
        build: .
        # container_name: IsThereAGame
        image: is_there_a_game:latest
        depends_on:
            - db
        environment:
            DATABASE_URL: postgresql://example:example@db:5432/example_db
            LOGICAL_ENV: ${LOGICAL_ENV}
            SERVICE_URL: ${IS_THERE_A_FUCKING_GAME_SERVICE_URL}
            PYTHONUNBUFFERED: 1
        # command: bash entrypoint.sh
        # volumes:
        #     - .:/app
        # ports:
        #     - 8204:8000
        links:
            - db

        # labels:
        #     - "traefik.enable=true"
        #     - "traefik.http.routers.is-there-a-game_lan.entrypoints=web"
        #     - "traefik.http.routers.is-there-a-game_lan.rule=Host(`is-there-a-game.bragi.lan`)"
        #     - "traefik.http.routers.is-there-a-game.rule=Host(`is-there-a-game.nax.lol`)"
        #     - "traefik.http.routers.is-there-a-game.entrypoints=web"
        #     - "traefik.http.services.is-there-a-game.loadbalancer.server.port=8000"
        #     # - "traefik.http.routers.dashy_local.tls=true"

volumes:
  postgres_data:
